
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Compton Bentonville – Contract Outline Builder</title>
  <style>
    :root {
      --bg: #f7f8fa;
      --card: #ffffff;
      --text: #172b4d;
      --muted: #5e6c84;
      --primary: #204d63;
      --accent: #2b8a3e;
      --danger: #b00020;
      --border: #dee2e6;
    }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg); color: var(--text);
    }
    header {
      background: var(--primary); color: #fff; padding: 16px 24px;
    }
    header h1 { margin: 0; font-size: 18px; font-weight: 600; }
    .container { max-width: 1080px; margin: 24px auto; padding: 0 16px; }
    .grid { display: grid; gap: 16px; }
    .cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 10px; padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,.04);
    }
    .card h2 { margin: 0 0 8px; font-size: 18px; }
    .card h3 { margin: 12px 0 6px; font-size: 16px; }
    label { display: block; margin: 8px 0 4px; font-size: 14px; color: var(--muted); }
    input[type="text"], input[type="email"], input[type="tel"], input[type="date"], textarea, select {
      width: 100%; padding: 8px 10px; border: 1px solid var(--border);
      border-radius: 8px; font-size: 14px; background: #fff; color: var(--text);
    }
    textarea { min-height: 180px; resize: vertical; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { border: 1px solid var(--border); padding: 6px 8px; font-size: 13px; }
    th { background: #f2f4f7; text-align: left; }
    .btn-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    button {
      background: var(--primary); color: #fff; border: none; padding: 8px 12px;
      border-radius: 8px; font-size: 14px; cursor: pointer;
    }
    button.secondary { background: #42526e; }
    button.success { background: var(--accent); }
    button.danger { background: var(--danger); }
    .inline-radio { display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px; }
    .inline-radio label { margin: 0; display: inline-flex; align-items: center; gap: 6px; color: var(--text); }
    .muted { color: var(--muted); font-size: 13px; }
    .preview {
      white-space: pre-wrap; border: 1px dashed var(--border); background: #fbfcff;
      padding: 12px; border-radius: 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    .footer-note { font-size: 12px; color: var(--muted); margin-top: 6px; }
    /* Password Gate */
    #gate {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      display: grid; place-items: center; z-index: 9999;
    }
    #gate .panel {
      width: 92%; max-width: 420px; background: #fff; border-radius: 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.18); padding: 18px;
      border: 1px solid var(--border);
    }
    #gate h2 { margin: 0 0 8px; font-size: 18px; }
    #gate p { margin: 0 0 12px; color: var(--muted); font-size: 14px; }
    #gate .error { color: var(--danger); font-size: 13px; min-height: 18px; }
    @media (max-width: 800px) {
      .cols-2 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div id="gate" aria-modal="true" role="dialog">
    <div class="panel">
      <h2>Protected Page</h2>
      <p>Please enter the password to access the contract builder.</p>
      <label for="pw">Password</label>
      <input type="password" id="pw" placeholder="Enter password" />
      <div class="btn-row">
        <button id="pwSubmit">Unlock</button>
      </div>
      <div class="error" id="pwError" role="alert" aria-live="polite"></div>
      <p class="footer-note">Note: Client-side protection; not suitable for sensitive data.</p>
    </div>
  </div>

  <header>
    <h1>Compton Bentonville – Contract Outline Builder</h1>
  </header>

  <main class="container" id="app" style="display:none;">
    <div class="grid cols-2">
      <!-- Left: Core Inputs -->
      <section class="card">
        <h2>Group & Event Details (Fields 1–12)</h2>
        <div class="grid cols-2">
          <div>
            <label for="f1">1) Name of Group/Contact</label>
            <input id="f1" type="text" placeholder="e.g., Bentonville Art Expo" />
          </div>
          <div>
            <label for="f2">2) Primary Contact Name</label>
            <input id="f2" type="text" placeholder="e.g., Jane Doe" />
          </div>
          <div>
            <label for="f3">3) Primary Contact Phone</label>
            <input id="f3" type="tel" placeholder="e.g., (479) 555‑1234" />
          </div>
          <div>
            <label for="f4">4) Primary Contact Email</label>
            <input id="f4" type="email" placeholder="e.g., jane@example.com" />
          </div>
          <div>
            <label for="f5">5) Primary Contact Address</label>
            <input id="f5" type="text" placeholder="e.g., 123 Main St, Bentonville, AR 72712" />
          </div>
          <div>
            <label for="f6">6) Event Name</label>
            <input id="f6" type="text" placeholder="e.g., Annual Celebration Dinner" />
          </div>
          <div>
            <label for="f7">7) Event Dates (Arrival/Departure)</label>
            <input id="f7" type="text" placeholder="e.g., 04/10/2026 – 04/12/2026" />
          </div>
          <div>
            <label for="f8">8) Concessions Offered</label>
            <input id="f8" type="text" placeholder="e.g., 10% F&B discount; complimentary Wi‑Fi" />
          </div>
          <div>
            <label for="f9">9) Total Function Room Revenue (no tax or fees)</label>
            <input id="f9" type="text" placeholder="e.g., 3500" />
          </div>
          <div>
            <label for="f10">10) Food and Beverage Minimum (no tax or fees)</label>
            <input id="f10" type="text" placeholder="e.g., 12000" />
          </div>
          <div>
            <label for="f11">11) Room Rental Taxes and Fees</label>
            <input id="f11" type="text" placeholder="e.g., 805" />
          </div>
          <div>
            <label for="f12">12) F&B Minimum Taxes and Fees</label>
            <input id="f12" type="text" placeholder="e.g., 3456" />
          </div>
        </div>
      </section>

      <!-- Right: Radios -->
      <section class="card">
        <h2>Selections & Options</h2>
        <h3>Function Room Usage Fees</h3>
        <div class="inline-radio" id="roomFeeGroup">
          <label><input type="radio" name="roomFee" value="fee" /> Room Rental Fee</label>
          <label><input type="radio" name="roomFee" value="waived" /> Waived Room Rental Fee</label>
        </div>

        <h3>Deposit Schedule</h3>
        <div class="inline-radio" id="depositGroup">
          <label><input type="radio" name="deposit" value="yes9030" /> Yes – 90/30</label>
          <label><input type="radio" name="deposit" value="yesOther" /> Yes – Other</label>
          <label><input type="radio" name="deposit" value="no" /> No</label>
        </div>

        <h3>Direct Billing</h3>
        <div class="inline-radio" id="billingGroup">
          <label><input type="radio" name="billing" value="yes" /> Yes</label>
          <label><input type="radio" name="billing" value="no" /> No</label>
        </div>

        <h3>Credit Card Hold</h3>
        <div class="inline-radio" id="cchGroup">
          <label><input type="radio" name="cch" value="yes" /> Yes</label>
          <label><input type="radio" name="cch" value="no" /> No</label>
        </div>
        <p class="footer-note">Selections above control conditional sections in the final contract text.</p>
      </section>
    </div>

    <!-- Function Agenda -->
    <section class="card">
      <h2>Function Agenda</h2>
      <table id="agendaTable" aria-label="Function Agenda">
        <thead>
          <tr>
            <th>Date (MM/DD/YYYY)</th>
            <th>Time (Start to Finish)</th>
            <th>Event Type</th>
            <th>Function Space</th>
            <th>Setup Style</th>
            <th>Anticipated Attendance</th>
            <th>Room Rental</th>
            <th>Minimum</th>
          </tr>
        </thead>
        <tbody id="agendaBody">
          <!-- Two blank starter rows -->
        </tbody>
      </table>
      <div class="btn-row">
        <button id="addAgendaRow" class="secondary">Add another row</button>
      </div>
      <p class="footer-note">Tip: Fill out at least the Date, Time, Event Type, and Function Space for clarity.</p>
    </section>

    <!-- Anticipated Revenue -->
    <section class="card">
      <h2>Anticipated Revenue</h2>
      <table aria-label="Anticipated Revenue">
        <thead>
          <tr>
            <th>Category</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody id="revBody">
          <tr>
            <td>Total anticipated Food and Beverage revenue</td>
            <td><input type="text" class="revInput" placeholder="e.g., 12000" /></td>
          </tr>
          <tr>
            <td>Anticipated Function Room usage fees</td>
            <td><input type="text" class="revInput" placeholder="e.g., 3500" /></td>
          </tr>
          <tr>
            <td>Additional anticipated revenue (if applicable)</td>
            <td><input type="text" class="revInput" placeholder="e.g., 600" /></td>
          </tr>
          <tr>
            <td>Total anticipated revenue</td>
            <td><input type="text" class="revInput" placeholder="Manual or leave blank" /></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Conditional Deposit Schedule Table -->
    <section class="card" id="depositTableSection" style="display:none;">
      <h2>Deposit Schedule</h2>
      <table id="depositTable" aria-label="Deposit Schedule">
        <thead>
          <tr>
            <th>Payment Type</th>
            <th>Payment Form</th>
            <th>Due Date</th>
            <th>Deposit Amount</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Deposit</td>
            <td>Card/Wire</td>
            <td>Upon Signing</td>
            <td><input type="text" class="depAmt" placeholder="e.g., 25% of anticipated" /></td>
            <td>25% of the anticipated charges</td>
          </tr>
          <tr>
            <td>Deposit</td>
            <td>Card/Wire</td>
            <td><input type="text" class="depDue" placeholder="e.g., MM/DD/YYYY" /></td>
            <td><input type="text" class="depAmt" placeholder="e.g., 50% of anticipated" /></td>
            <td>50% of the anticipated charges</td>
          </tr>
          <tr>
            <td>Deposit</td>
            <td>Card/Wire</td>
            <td><input type="text" class="depDue" placeholder="e.g., MM/DD/YYYY" /></td>
            <td><input type="text" class="depAmt" placeholder="e.g., remaining balance" /></td>
            <td>Remaining balance of anticipated charges</td>
          </tr>
          <tr>
            <td>Additional Deposit</td>
            <td>Card/Wire</td>
            <td><input type="text" class="depDue" placeholder="e.g., MM/DD/YYYY" /></td>
            <td><input type="text" class="depAmt" placeholder="e.g., 10% post-event refund if unused" /></td>
            <td>10% of the total anticipated revenue to be refund post‑event to the extent unused</td>
          </tr>
        </tbody>
      </table>
      <p class="footer-note">This table appears only when Deposit Schedule is set to “Yes – 90/30” or “Yes – Other”.</p>
    </section>

    <!-- Contract Template & Preview -->
    <section class="card">
      <h2>Contract Outline – Template</h2>
      <p class="muted">You can edit the supporting text below. Placeholders like [1]…[12], [9 + 11], [10 + 12], and table insert markers will auto‑fill in the preview.</p>
      <textarea id="templateArea">
Catering Sales Agreement
This Group Sales Agreement (the “Agreement”) is made by and between the legal owner entity of The Compton Bentonville (the “Hotel”) located at 200 East Central Ave., Bentonville, AR 72712, and [1] (the “Group”). This Agreement becomes binding only after it is executed by both parties. Blank spaces herein are intended to be completed at the time of contracting for a specific event and should remain blank until that time.
// 
DESCRIPTION OF GROUP AND EVENT
Primary Contact Name    [2]
Primary Contact Phone   [3]
Primary Contact Email   [4]
Primary Contact Address [5]
Event Name              [6]
Event Dates (Arrival/Departure) [7]
// 
Parking
Hotel offers complimentary self parking in downtown Bentonville on a first come, first served basis. Guests may park in any public parking structure or surface lot in the vicinity of the hotel at the driver’s own risk and subject to availability. Hotel does not guarantee the availability of a specific space and is not liable for loss or damage to vehicles or their contents. Valet parking is available at the hotel’s front drive at a rate of $17 for day-use, or $30 per night, subject to prevailing taxes and fees.
// 
Special Concessions
If specified in writing at the time of contracting, the Hotel may extend concessions. Any concessions will be contingent on the Group meeting its room night and food and beverage commitments and may be adjusted proportionately if actual revenues are reduced. All concessions are based upon minimum group room achievement and may, at Hotel’s sole discretion, be reduced or dissolved upon a lack of room night pickup.
Concessions Offered By Hotel:
• [8]
// 
FUNCTION ROOM AND CATERING SERVICES
Function Agenda
If the Group requires meeting or banquet facilities, the Hotel will reserve the function space described below:
[insert table "Function Agenda"]
The total anticipated function room revenue is $[9] (exclusive of taxes and service charges). The Hotel reserves the right to substitute function space with comparable space if the Group’s needs change or if the reserved space becomes unavailable.
// 
Function Room Usage Fees
ROOM RENTAL FEE [if matching radio box is selected]
The Hotel will charge the Group a function room usage fee as quoted above. Fees are subject to applicable taxes. The Hotel may adjust the fee if the Room Block or the size/number of functions is reduced.

WAIVED ROOM RENTAL FEE [if matching radio box is selected]
The Hotel will waive room rental fees if the Group meets the food and beverage minimum defined below. If the Group fails to meet the minimum, room rental fees at prevailing rates will be charged.
// 
Failure to Vacate
All events must conclude, and all guests, vendors, and personal property must be fully vacated from the function space by the designated end time stated in the above function agenda. Failure to vacate the function space(s) by the agreed-upon time may result in additional charges, including but not limited to overtime labor fees, extended room rental, and security costs. The Compton Bentonville reserves the right to remove or dispose of any items left on the premises after the event concludes and shall not be held liable for any loss or damage resulting therefrom.
// 
Taxes, Service Charges, and Gratuities
All charges are subject to a 23% service charge, as well as applicable federal, state, and local taxes. Taxes and service charges are subject to change at any time, and the Group shall be responsible for payment of any increases in effect at the time of the event. Additional gratuities are at the Group’s discretion. Please consult with your Sales Manager for a list of applicable taxes and fees.
// 
Function Room Set‑Up and Operation
The Group must obtain the Hotel’s written approval before installing equipment, displays or decorations. The Group is responsible for any damage or injury arising from such items and shall indemnify and hold the Hotel harmless from related claims. Additional charges may apply for elaborate setups, specialty equipment, rigging or room re‑sets. Final function room setup specifications are due from the Group fourteen (14) days prior to the event start date. All function room setups must be approved by Hotel’s Conference Services Manager. Any setup changes requested within seventy‑two (72) hours of the event start date that the Hotel deems excessive will incur a minimum fee of five hundred dollars ($500).

Glitter, confetti, loose sequins, rice, sparklers, open flames, or any similar materials are not permitted in any Hotel space. The Hotel reserves the right, at its sole discretion, to remove any decor that is deemed unsafe, damaging to the property, or not in alignment with Hotel guidelines.
// 
Approved Vendor List
To preserve the quality, safety, and overall guest experience of events hosted at The Compton, the Hotel maintains an Approved Vendor List of qualified professionals. All vendors providing services on property must be selected from this list unless prior written approval is granted by the hotel. The current list of approved vendors will be made available to the Group upon request. The Hotel reserves the right to update or modify the Approved Vendor List at its discretion.
// 
Food and Beverage Minimum and Performance
The rates and concessions offered are based on the food and beverage minimum. If the Group’s actual food and beverage revenue (excluding taxes, service charges, audio‑visual, parking and other miscellaneous charges) is less than $[10] (the “Food and Beverage Minimum”), then the Group shall pay as liquidated damages the difference between the minimum and actual revenue (the “Food and Beverage Performance Fee”). Any performance fee will be added to the Master Account. The Group remains liable for room rental fees and other charges.
// 
Food and Beverage Policies
All food and beverage served on Hotel premises must be supplied and prepared by the Hotel, unless otherwise agreed in writing. Leftover food and beverage may not be removed from the Hotel. Menu selections must be provided no later than twenty-one (21) days prior to the Event start date (the “Menu Deadline”). Final attendance guarantees must be provided fourteen (14) days before the Event start date; otherwise, the number in this Agreement will be used. Charges will be based on the final guarantee even if fewer guests attend. The Hotel reserves the right to charge for special dietary requests not confirmed in writing.

Menu offerings and pricing are confirmed ninety (90) days prior to the event start date. Any proposals shared or selections made more than ninety (90) days before the event start date are subject to change.
// 
BILLING AND CREDIT PROCEDURES
Master Account and Authorized Representatives
A “Master Account” will be established to record all charges payable by the Group under this Agreement (including sleeping rooms, food and beverage, room rental, audio‑visual, parking, service charges, taxes and performance/cancellation fees). The Group shall designate in writing, at least forty‑five (45) days prior to the Arrival Date, one or more representatives authorized to incur charges to the Master Account. The Group acknowledges that any person who signs a banquet event order or makes arrangements on site shall be deemed an authorized representative.
[Input table "Deposit Schedule" if either "Yes" option is selected]
// 
Deposit Schedule Breakdown
Room Rental = $[9] + Sales Taxes + 23% Service Fee = $[9 + 11]
Food &amp; Beverage Minimum = $[10] + Sales Taxes + 23% Service Fee = $[10 + 12]
Total Anticipated Revenue (inclusive of sales taxes/service fees) = $___

Deposits will be applied to the Master Account. The Hotel may terminate the Agreement and retain deposits if any scheduled payment is not received.
      </textarea>

      <div class="btn-row">
        <button id="refreshPreview" class="secondary">Refresh Preview</button>
        <button id="copyPreview" class="success">Copy to Clipboard</button>
      </div>

      <h3>Live Preview</h3>
      <div id="preview" class="preview" aria-live="polite"></div>
    </section>
  </main>

  <script>
    // --- Password Gate ---
    (function gate() {
      const pwInput = document.getElementById('pw');
      const submit = document.getElementById('pwSubmit');
      const error = document.getElementById('pwError');
      submit.addEventListener('click', () => {
        const v = (pwInput.value || '').trim();
        if (v === '4273') {
          document.getElementById('gate').style.display = 'none';
          document.getElementById('app').style.display = '';
          // Focus first field
          document.getElementById('f1').focus();
        } else {
          error.textContent = 'Incorrect password. Please try again.';
        }
      });
      pwInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') submit.click();
      });
    })();

    // --- Helpers ---
    function val(id) {
      const el = document.getElementById(id);
      return (el && el.value != null) ? el.value.trim() : '';
    }
    function parseAmount(raw) {
      if (!raw) return NaN;
      const cleaned = String(raw).replace(/[^0-9.\-]/g, '');
      const num = parseFloat(cleaned);
      return isFinite(num) ? num : NaN;
    }
    function formatCurrency(num) {
      if (!isFinite(num)) return '';
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(num);
    }

    // --- Agenda Table ---
    const agendaBody = document.getElementById('agendaBody');
    function addAgendaRow() {
      const tr = document.createElement('tr');
      const cols = 8;
      for (let c = 0; c < cols; c++) {
        const td = document.createElement('td');
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.placeholder = [
          'MM/DD/YYYY','e.g., 6:00 PM – 9:00 PM','e.g., Banquet','e.g., Ballroom',
          'e.g., Banquet','e.g., 120','e.g., 1500','e.g., 12000'
        ][c];
        inp.addEventListener('input', updatePreview);
        td.appendChild(inp);
        tr.appendChild(td);
      }
      agendaBody.appendChild(tr);
    }
    // Initialize two blank rows
    addAgendaRow(); addAgendaRow();
    document.getElementById('addAgendaRow').addEventListener('click', addAgendaRow);

    // --- Radios & Deposit Table toggle ---
    const depositTableSection = document.getElementById('depositTableSection');
    function updateDepositVisibility() {
      const dep = document.querySelector('input[name="deposit"]:checked');
      const show = dep && (dep.value === 'yes9030' || dep.value === 'yesOther');
      depositTableSection.style.display = show ? '' : 'none';
    }
    document.getElementById('depositGroup').addEventListener('change', () => {
      updateDepositVisibility(); updatePreview();
    });
    document.getElementById('roomFeeGroup').addEventListener('change', updatePreview);
    document.getElementById('billingGroup').addEventListener('change', updatePreview);
    document.getElementById('cchGroup').addEventListener('change', updatePreview);

    // --- Build text table for Agenda ---
    function buildAgendaTextTable() {
      const headers = [
        'Date (MM/DD/YYYY)', 'Time (Start to Finish)', 'Event Type', 'Function Space',
        'Setup Style', 'Anticipated Attendance', 'Room Rental', 'Minimum'
      ];
      const rows = [];
      for (const tr of agendaBody.querySelectorAll('tr')) {
        const cells = [...tr.querySelectorAll('td input')].map(inp => (inp.value || '').trim());
        rows.push(cells);
      }
      // Build a simple markdown-like table for copy+paste
      const sep = '|';
      const headerLine = sep + headers.join(sep) + sep;
      const ruleLine   = sep + headers.map(()=>'---').join(sep) + sep;
      const rowLines   = rows.map(r => sep + r.map(c => c || ' ').join(sep) + sep);
      return [headerLine, ruleLine, ...rowLines].join('\n');
    }

    // --- Build text table for Deposit Schedule (conditional) ---
    function buildDepositTextTable() {
      const depRows = document.querySelectorAll('#depositTable tbody tr');
      const headers = ['Payment Type','Payment Form','Due Date','Deposit Amount','Notes'];
      const sep = '|';
      const headerLine = sep + headers.join(sep) + sep;
      const ruleLine   = sep + headers.map(()=>'---').join(sep) + sep;
      const rowLines = [];
      depRows.forEach(tr => {
        const tds = tr.querySelectorAll('td');
        const vals = [];
        // td0 Payment Type (text)
        vals.push(tds[0].textContent.trim());
        // td1 Payment Form (text)
        vals.push(tds[1].textContent.trim());
        // td2 Due Date (text or input)
        const due = tds[2].querySelector('input') ? tds[2].querySelector('input').value.trim() : tds[2].textContent.trim();
        vals.push(due || ' ');
        // td3 Amount (input)
        const amt = tds[3].querySelector('input') ? tds[3].querySelector('input').value.trim() : tds[3].textContent.trim();
        vals.push(amt || ' ');
        // td4 Notes (text)
        vals.push(tds[4].textContent.trim());
        rowLines.push(sep + vals.join(sep) + sep);
      });
      return [headerLine, ruleLine, ...rowLines].join('\n');
    }

    // --- Contract Preview Builder ---
    function updatePreview() {
      let tmpl = document.getElementById('templateArea').value || '';

      // Replace basic placeholders [1]..[12]
      for (let i = 1; i <= 12; i++) {
        const re = new RegExp('\\[' + i + '\\]', 'g');
        tmpl = tmpl.replace(re, (val('f' + i) || ''));
      }

      // Replace [9 + 11] and [10 + 12] math with formatted sums
      const v9  = parseAmount(val('f9'));
      const v10 = parseAmount(val('f10'));
      const v11 = parseAmount(val('f11'));
      const v12 = parseAmount(val('f12'));
      const sum911 = formatCurrency((isFinite(v9) && isFinite(v11)) ? (v9 + v11) : NaN);
      const sum1012 = formatCurrency((isFinite(v10) && isFinite(v12)) ? (v10 + v12) : NaN);
      tmpl = tmpl.replace(/\[9 \+ 11\]/g, sum911 || '');
      tmpl = tmpl.replace(/\[10 \+ 12\]/g, sum1012 || '');

      // Format [9] and [10] if they appear with $ immediately before (light touch)
      tmpl = tmpl.replace(/\$\[9\]/g, formatCurrency(isFinite(v9) ? v9 : NaN) || ('$' + (val('f9') || '')));
      tmpl = tmpl.replace(/\$\[10\]/g, formatCurrency(isFinite(v10) ? v10 : NaN) || ('$' + (val('f10') || '')));

      // Insert Function Agenda text table
      tmpl = tmpl.replace(/\[insert table "Function Agenda"\]/g, buildAgendaTextTable());

      // Conditional: Deposit Schedule table insertion
      const depSel = document.querySelector('input[name="deposit"]:checked');
      const showDeposit = depSel && (depSel.value === 'yes9030' || depSel.value === 'yesOther');
      const depositTextTable = buildDepositTextTable();
      if (showDeposit) {
        tmpl = tmpl.replace(/\[Input table "Deposit Schedule" if either "Yes" option is selected\]/g, depositTextTable);
      } else {
        tmpl = tmpl.replace(/\[Input table "Deposit Schedule" if either "Yes" option is selected\]/g, '');
      }

      // Conditional: Function Room Usage Fees blocks
      const roomFeeSel = document.querySelector('input[name="roomFee"]:checked');
      const choice = roomFeeSel ? roomFeeSel.value : null;

      // Remove WAIVED block if fee selected; or remove FEE block if waived selected
      // Identify blocks by headings:
      // "ROOM RENTAL FEE [if matching radio box is selected]" ... up to next heading "WAIVED ROOM RENTAL FEE ..."
      // Then "WAIVED ROOM RENTAL FEE ..." ... up to next heading "Failure to Vacate"
      function removeBlock(text, startHeading, endHeading) {
        const startIdx = text.indexOf(startHeading);
        if (startIdx === -1) return text;
        const endIdx = text.indexOf(endHeading, startIdx + startHeading.length);
        const cutoff = endIdx !== -1 ? endIdx : text.length;
        return text.slice(0, startIdx) + text.slice(cutoff);
      }
      if (choice === 'fee') {
        tmpl = removeBlock(tmpl, 'WAIVED ROOM RENTAL FEE [if matching radio box is selected]', 'Failure to Vacate');
        // Also strip the marker "[if matching radio box is selected]" from retained heading
        tmpl = tmpl.replace('ROOM RENTAL FEE [if matching radio box is selected]', 'ROOM RENTAL FEE');
      } else if (choice === 'waived') {
        tmpl = removeBlock(tmpl, 'ROOM RENTAL FEE [if matching radio box is selected]', 'WAIVED ROOM RENTAL FEE [if matching radio box is selected]');
        tmpl = tmpl.replace('WAIVED ROOM RENTAL FEE [if matching radio box is selected]', 'WAIVED ROOM RENTAL FEE');
      } else {
        // No selection: keep both headings but remove markers
        tmpl = tmpl.replace('ROOM RENTAL FEE [if matching radio box is selected]', 'ROOM RENTAL FEE');
        tmpl = tmpl.replace('WAIVED ROOM RENTAL FEE [if matching radio box is selected]', 'WAIVED ROOM RENTAL FEE');
      }

      // Cosmetic: Convert '//' markers to blank line spacing
      tmpl = tmpl.replace(/\n\/\/\s*/g, '\n\n');

      // Set preview
      document.getElementById('preview').textContent = tmpl;
    }

    // Wire inputs to live preview updates
    for (let i = 1; i <= 12; i++) {
      document.getElementById('f' + i).addEventListener('input', updatePreview);
    }
    document.querySelectorAll('.revInput').forEach(inp => inp.addEventListener('input', updatePreview));
    document.querySelectorAll('.depDue, .depAmt').forEach(inp => inp.addEventListener('input', updatePreview));
    document.getElementById('templateArea').addEventListener('input', updatePreview);
    document.getElementById('refreshPreview').addEventListener('click', updatePreview);

    // Initial preview
    updateDepositVisibility();
    updatePreview();

    // Copy to clipboard
    document.getElementById('copyPreview').addEventListener('click', async () => {
      const text = document.getElementById('preview').textContent || '';
      try {
        await navigator.clipboard.writeText(text);
        const btn = document.getElementById('copyPreview');
        const old = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = old, 1500);
      } catch {
        alert('Copy failed. You can manually select and copy the text.');
      }
    });
  </script>
</body>
</html>
