
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Compton Bentonville – Catering Sales Agreement Builder</title>
  <style>
    :root { --accent:#0b6efd; --bg:#f8f9fb; --card:#ffffff; --text:#1f2937; --muted:#6b7280; --danger:#b91c1c; --ok:#155724; }
    html,body{height:100%;}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; color:var(--text); background:var(--bg);}
    header{background:#111827; color:#fff; padding:16px 20px; display:flex; align-items:center; gap:12px; position:sticky; top:0; z-index:2;}
    header h1{font-size:18px; margin:0; font-weight:600;}
    .lock-screen{position:fixed; inset:0; background:#0f172a; color:#e5e7eb; display:flex; align-items:center; justify-content:center; z-index:9999;}
    .lock-card{background:#111827; border:1px solid #1f2937; padding:28px; border-radius:12px; width:min(92vw,420px); box-shadow:0 10px 30px rgba(0,0,0,.4);}
    .lock-card h2{margin:0 0 8px; font-size:20px;}
    .lock-card p{margin:0 0 16px; color:#9ca3af;}
    .row{display:flex; gap:12px;}
    .field{display:flex; flex-direction:column; gap:6px; margin-bottom:14px;}
    label{font-size:13px; color:#374151; font-weight:600;}
    input[type="text"], input[type="tel"], input[type="email"], input[type="number"], input[type="date"], textarea, select{padding:10px 12px; border:1px solid #d1d5db; border-radius:8px; background:#fff; font-size:14px;}
    textarea{min-height:72px;}
    button{background:var(--accent); color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600;}
    button.secondary{background:#e5e7eb; color:#111827;}
    button.link{background:transparent; color:var(--accent); padding:0; border:none;}
    button.danger{background:var(--danger);}
    .container{max-width:1060px; margin:20px auto; padding:0 16px;}
    .card{background:var(--card); border:1px solid #e5e7eb; border-radius:12px; padding:16px; margin-bottom:16px;}
    .card h3{margin:0 0 12px; font-size:16px;}
    table{width:100%; border-collapse:collapse;}
    th, td{border:1px solid #e5e7eb; padding:8px; font-size:13px; vertical-align:top;}
    th{background:#f3f4f6; text-align:left;}
    .actions{display:flex; gap:10px; flex-wrap:wrap;}
    .muted{color:#6b7280;}
    .right{ text-align:right; }
    .hidden{display:none;}
    .totals{background:#f9fafb; border:1px dashed #d1d5db; padding:10px; border-radius:8px;}
    .pill{display:inline-block; padding:2px 8px; border-radius:20px; background:#eef2ff; color:#3730a3; font-size:12px; font-weight:600;}
    .footer{color:#6b7280; font-size:12px; text-align:center; padding:24px;}
  </style>

  <!-- External libs for export
       NOTE: Removed SRI integrity attributes so GitHub Pages won't block outdated hashes.
       Kept versions pinned to avoid surprises. -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html-docx-js/0.4.1/html-docx.js" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div class="lock-screen" id="lock">
    <div class="lock-card">
      <h2>Enter Password</h2>
      <p>No lockout or penalty on failed attempts.</p>
      <div class="field">
        <label for="pw">Password</label>
        <input type="password" id="pw" placeholder="Enter password" />
      </div>
      <div class="actions">
        <button id="unlockBtn">Unlock</button>
        <button class="secondary" id="showHintBtn" type="button">Hint</button>
        <span id="hint" class="muted" style="display:none">It is 4 digits.</span>
      </div>
      <p id="lockMsg" class="muted" style="margin-top:10px"></p>
    </div>
  </div>

  <header>
    <h1>Catering Sales Agreement Builder</h1>
    <span class="pill">The Compton Bentonville</span>
  </header>

  <div class="container" id="app" style="display:none">
    <div class="card">
      <h3>A) Group & Event Overview</h3>
      <div class="row">
        <div class="field" style="flex:2">
          <label>Group / Organization Name</label>
          <input type="text" id="groupName"/>
        </div>
        <div class="field" style="flex:1">
          <label>Event Name</label>
          <input type="text" id="eventName"/>
        </div>
      </div>
      <div class="row">
        <div class="field" style="flex:1">
          <label>Primary Contact – First & Last Name</label>
          <input type="text" id="pcName"/>
        </div>
        <div class="field" style="flex:1">
          <label>Phone</label>
          <input type="tel" id="pcPhone"/>
        </div>
        <div class="field" style="flex:1">
          <label>Email</label>
          <input type="email" id="pcEmail"/>
        </div>
      </div>
      <div class="field">
        <label>Primary Contact – Address</label>
        <textarea id="pcAddress" placeholder="Street, City, State ZIP"></textarea>
      </div>
      <div class="row">
        <div class="field" style="flex:1">
          <label>Arrival Date</label>
          <input type="date" id="arrival"/>
        </div>
        <div class="field" style="flex:1">
          <label>Departure Date</label>
          <input type="date" id="departure"/>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>B) Parking & Special Concessions</h3>
      <div class="field">
        <label><input type="checkbox" id="includeConcessions"/> Include Special Concessions section</label>
      </div>
      <!-- FIX: remove duplicate class attribute; use one with both classes if needed -->
      <div class="field hidden" id="concessionsWrap">
        <label>Concessions Offered by Hotel</label>
        <textarea id="concessionsText" placeholder="List any concessions to include"></textarea>
      </div>
    </div>

    <div class="card">
      <h3>C) Function Agenda <span class="muted">(add rows for multi‑day/multi‑space)</span></h3>
      <div class="actions" style="margin-bottom:8px">
        <button type="button" id="addAgendaRowBtn">+ Add Row</button>
      </div>
      <table id="agendaTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Time (free text)</th>
            <th>Event Type</th>
            <th>Function Space</th>
            <th>Setup Style</th>
            <th>Anticipated Attendance</th>
            <th>Room Rental (USD)</th>
            <th>F&B Minimum (USD)</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="row" style="margin-top:10px">
        <div class="field" style="flex:1">
          <label>Total Anticipated Function Room Revenue (auto‑sum)</label>
          <input type="text" id="totalRoomRentalAuto" readonly />
        </div>
        <div class="field" style="flex:1">
          <label>Override Total Function Room Revenue (optional)</label>
          <input type="text" id="totalRoomRentalOverride" placeholder="$0.00" />
        </div>
      </div>

      <div class="totals">
        <div><strong>Tax/Service Calculation Rules</strong></div>
        <ul>
          <li><strong>Function Room Fees:</strong> Apply <b>2% A&P</b> and <b>23% service</b> to the room subtotal; then apply <b>9.5% sales tax</b> to the <em>service fee amount only</em>.</li>
          <li><strong>F&B Minimums:</strong> Apply <b>10.5% sales tax</b> and <b>23% service</b> to the F&B subtotal; then apply <b>9.5% sales tax</b> to the <em>service fee amount only</em>.</li>
          <li>Date format in outputs: <em>Friday, January 16, 2026</em>.</li>
        </ul>
      </div>
    </div>

    <div class="card">
      <h3>D) Food & Beverage Minimums</h3>
      <div class="row">
        <div class="field" style="flex:1">
          <label>Overall F&B Minimum (USD)</label>
          <input type="text" id="fnbOverall" placeholder="$0.00" />
        </div>
        <div class="field" style="flex:1; align-items:flex-end; justify-content:flex-end;">
          <label><input type="checkbox" id="includePerDayFnb"/> Include Per‑Day F&B Minimum Clause</label>
        </div>
      </div>

      <div id="perDayFnbWrap" class="hidden">
        <div class="actions" style="margin-bottom:8px">
          <button type="button" id="addPerDayRowBtn">+ Add Per‑Day Minimum</button>
        </div>
        <table id="perDayTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>F&B Minimum (USD)</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h3>E/F) Billing Method</h3>
      <div class="field">
        <label>Choose one</label>
        <div>
          <label><input type="radio" name="billingMethod" value="deposit" checked> Deposit Schedule</label>
          <label style="margin-left:18px"><input type="radio" name="billingMethod" value="direct"> Direct Billing</label>
        </div>
      </div>

      <div id="depositWrap">
        <div class="actions" style="margin-bottom:8px">
          <button type="button" id="addDepositRowBtn">+ Add Deposit Row</button>
        </div>
        <table id="depositTable">
          <thead>
            <tr>
              <th>Payment Type</th>
              <th>Payment Form</th>
              <th>Due Date (text or date)</th>
              <th>Deposit Amount (USD)</th>
              <th>Notes</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="totals" style="margin-top:10px">
          <div style="font-weight:700; margin-bottom:6px">Deposit Schedule Breakdown (auto‑calc)</div>
          <div class="row">
            <div class="field" style="flex:1">
              <label>Room Rental Subtotal (from C)</label>
              <input type="text" id="roomSubTotal" readonly />
            </div>
            <div class="field" style="flex:1">
              <label>F&B Subtotal (from D)</label>
              <input type="text" id="fnbSubTotal" readonly />
            </div>
          </div>
          <div class="row">
            <div class="field" style="flex:1">
              <label>Room – A&P (2%)</label>
              <input type="text" id="roomAP" readonly />
            </div>
            <div class="field" style="flex:1">
              <label>Room – Service (23%)</label>
              <input type="text" id="roomService" readonly />
            </div>
            <div class="field" style="flex:1">
              <label>Room – Sales Tax on Service (9.5%)</label>
              <input type="text" id="roomServiceTax" readonly />
            </div>
          </div>
          <div class="row">
            <div class="field" style="flex:1">
              <label>F&B – Sales Tax (10.5%)</label>
              <input type="text" id="fnbTax105" readonly />
            </div>
            <div class="field" style="flex:1">
              <label>F&B – Service (23%)</label>
              <input type="text" id="fnbService" readonly />
            </div>
            <div class="field" style="flex:1">
              <label>F&B – Sales Tax on Service (9.5%)</label>
              <input type="text" id="fnbServiceTax95" readonly />
            </div>
          </div>
          <div class="row">
            <div class="field" style="flex:1">
              <label>Total Anticipated Revenue (incl. taxes/service)</label>
              <input type="text" id="grandTotal" readonly />
            </div>
          </div>
        </div>
      </div>

      <div id="directWrap" class="hidden">
        <div class="field">
          <label>Direct Billing Options</label>
          <div>
            <label><input type="radio" name="directOption" value="cchold" checked> Credit Card Hold</label>
            <label style="margin-left:18px"><input type="radio" name="directOption" value="billnow"> Bill 100% at time of signing</label>
          </div>
        </div>

        <div id="ccHoldFields">
          <div class="row">
            <div class="field" style="flex:1">
              <label>Credit Card Hold Amount (USD)</label>
              <input type="text" id="ccHoldAmount" placeholder="$0.00" />
            </div>
            <div class="field" style="flex:1">
              <label>Convert hold to deposit X days before arrival (optional)</label>
              <input type="number" id="ccConvertDays" min="0" placeholder="e.g., 14" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>G) Cancellation – Revenue Summary</h3>
      <div class="row">
        <div class="field" style="flex:1">
          <label>Total Anticipated Food & Beverage Revenue (USD)</label>
          <input type="text" id="cancelFnb" placeholder="$0.00" />
        </div>
        <div class="field" style="flex:1">
          <label>Anticipated Function Room Usage Fees (USD)</label>
          <input type="text" id="cancelRoom" placeholder="$0.00" />
        </div>
        <div class="field" style="flex:1">
          <label>Anticipated Additional Revenue (USD)</label>
          <input type="text" id="cancelOther" placeholder="$0.00" />
        </div>
      </div>
      <div class="row">
        <div class="field" style="flex:1">
          <label>Total Anticipated Revenue (auto‑sum)</label>
          <input type="text" id="cancelTotal" readonly />
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Assets & Output</h3>
      <div class="row">
        <div class="field" style="flex:1">
          <label>Upload Logo (optional)</label>
          <input type="file" id="logoInput" accept="image/*" />
        </div>
        <div class="field" style="flex:1">
          <label>Filename Pattern</label>
          <input type="text" id="filenamePattern" value="CSA_{EventName}_{GroupName}_{YYYYMMDD}" />
        </div>
      </div>

      <div class="actions">
        <button id="btnPreview" type="button">Scroll to Preview</button>
        <button id="btnDocx" type="button">Download DOCX</button>
        <button id="btnPdf" type="button">Download PDF</button>
        <button id="btnCopy" type="button" class="secondary">Copy Filled Text</button>
        <button id="btnCopyRich" type="button" class="secondary">Copy Rich Text</button>
      </div>
    </div>

    <div class="card" id="previewCard">
      <h3>Live Preview (always on — ready to copy)</h3>
      <div id="preview" style="background:#fff; padding:24px; border:1px solid #e5e7eb; border-radius:8px; font-family: 'Georgia','Times New Roman',serif; font-size:14.5px; line-height:1.55;"></div>
    </div>

    <div class="footer">CSA Builder • Single‑page app for GitHub Pages • Password protected (client‑side)</div>
  </div>

<script>
(function(){
  // Password gate
  const unlockBtn = document.getElementById('unlockBtn');
  const pwInput = document.getElementById('pw');
  const lock = document.getElementById('lock');
  const app = document.getElementById('app');
  const lockMsg = document.getElementById('lockMsg');
  const hintBtn = document.getElementById('showHintBtn');
  const hint = document.getElementById('hint');

  function tryUnlock(){
    if(pwInput.value === '4273'){
      lock.style.display = 'none';
      app.style.display = 'block';
      // initial render when unlocking
      if (typeof window.recalcAll === 'function') window.recalcAll();
      if (typeof window.showPreview === 'function') window.showPreview();
    } else {
      lockMsg.textContent = 'Incorrect password. Please try again.';
      pwInput.value = '';
      pwInput.focus();
    }
  }
  unlockBtn.addEventListener('click', tryUnlock);
  pwInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ tryUnlock(); }});
  hintBtn.addEventListener('click', ()=>{ hint.style.display = hint.style.display==='none' ? 'inline' : 'none';});

  // Utilities
  function fmtCurrency(n){
    if(isNaN(n) || n===null) n = 0;
    return n.toLocaleString('en-US',{style:'currency', currency:'USD'});
  }
  function parseCurrency(str){
    if(!str) return 0;
    return Number(String(str).replace(/[^0-9.\-]/g,'')) || 0;
  }
  function longDate(str){
    if(!str) return '';
    const d = new Date(str + 'T12:00:00');
    if(isNaN(d)) return str;
    return new Intl.DateTimeFormat('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' }).format(d);
  }
  function todayYYYYMMDD(){
    const d = new Date();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${d.getFullYear()}${m}${day}`;
  }

  // DOM refs
  const includeConcessions = document.getElementById('includeConcessions');
  const concessionsWrap = document.getElementById('concessionsWrap');
  includeConcessions.addEventListener('change',()=>{ concessionsWrap.classList.toggle('hidden', !includeConcessions.checked); });

  const agendaTable = document.getElementById('agendaTable').querySelector('tbody');
  document.getElementById('addAgendaRowBtn').addEventListener('click', addAgendaRow);
  function addAgendaRow(vals={}){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="date" class="ag-date" value="${vals.date||''}"/></td>
      <td><input type="text" class="ag-time" placeholder="e.g., 6:00–9:00 PM" value="${vals.time||''}"/></td>
